# Form Manager - Search and Rescue (SAR) Agent Framework - CSC 581

## SAR Agent Modifications

### Insights

Andrew bright up a number of good points with his feedback. 

He mentions the system's tendency to fill text boxes that are part of a checkbox
field with text. This is something that bothered me too, during development,
though I've been unable to fix it due to technical constraints.

Another thing he brings up is performing a larger scale test with more data.
This is a good point, my initial testing had a pretty terse and open-ended
prompt, so this is a good place to test the system in more scenarios and see if
it generalizes well. He also points out the system's tendency to hallucinate
information at times. This is a good point, and was down both to LLMs inherently
and how I prompted the model in a way that it implied to fill anything if it
didn't know what to write. The former I can't do anything about, but doing a bit
of prompt engineering to improve the latter is a good area for improvement.

He also makes the point that some areas of the form may be important for manual
review, and that a summary of it's answers may be appropriate, to which I agree.
He makes the point that particular sections may be more important than others in
this respect, but I'm not sure how one could determine that ideogrammatically in
the general case unfortunately so I doubt I'll be able to go any further with
it.

Lastly, he suggests testing integration with other agents (e.g. Search Team
Leader). This would be interesting to do, though would probably be a bit tricky
integration wise.

### Modifications

The most immediately viable insights have been actioned upon and added to the
repo. A couple much more complex modifications have yet to be actioned to stay
in scope, and good ground for future work.

- [x] Larger Test
    - A test with a different form and longer prompt has been added to
      `test_form_agent.py` under `test_larger_form`
- [x] The system will hallucinate information
    - The prompt has been edited to instruct the model to not fill any
      information that is not specified in the prompt or otherwise can be
      reasonably confirmed from it
    - Seems to improve things but tends to fill less fields on average (even
      when it should be able to)
- [x] The system should provide a summary of the information filled
    - A summary has been added to the output dictionary, able to be accessed
      using the "summary" key
    - Tests now check the summary has been populated
- [ ] The system fills text boxes associated with unchecked check-boxes
    - This has not been actioned because PDFs give no way of associating
      check-boxes with fields, and as such implementing such a feature would be
      heuristic and very complex, as such, I've determined that it's
      out-of-scope
- [ ] Other agent integration
    - This has not been actioned to keep the agent self-contained, since the
      agent is designed to be primarily invoked by other agents, rather than the
      opposite
    - Significant technical cost and risk of integration hell


## Introduction

This repository aims to implement a primitive SAR agent for form management, specifically the subset of filling forms with content. It implements a system to fill fields of PDF forms with content as generated by an LLM according the the specifications of the user.

For more information about roles:
- https://docs.google.com/spreadsheets/d/1QZK5HAdDC-_XNui6S0JZTbJH5_PbYJTp8_gyhXmz8Ek/edit?usp=sharing
- https://docs.google.com/spreadsheets/d/11rBV9CbKNeQbWbaks8TF6GO7WcSUDS_-hAoH75UEkgQ/edit?usp=sharing

## Examples

Example usage can be found in `tests/test_form_agent.py` to fill out the fall protection plan form specified in `tests/fall-protection-plan-form.pdf`.

```python
agent = FormManager()
test_form = "fall-protection-rescue-plan-form.pdf"
form = PdfReader(test_form)
message = {
    "form": form,
    "content": 'fill out this form with basic fall protection plans, hard hats, etc, for a department called "Five Johns Labor Board" as signed by five Johns',
}
filled_form = agent.process_request(message)
```

## Prerequisites

- Python 3.8 or higher
- pyenv (recommended for Python version management)
- pip (for dependency management)

## Setup and Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd sar-project
```

2. Set up Python environment:
```bash
# Using pyenv (optional)
pyenv install 3.9.6  # or your preferred version
pyenv local 3.9.6

# Create and activate virtual environment
python -m venv .venv
source .venv/bin/activate  # On Unix/macOS
# or
.venv\Scripts\activate     # On Windows
```

3. Install dependencies:
```bash
pip install -r requirements.txt
pip install -e .
```

4. Configure environment variables:

#### Google Gemini:
- add `GOOGLE_API_KEY` to `.env` file

Make sure to keep your `.env` file private and never commit it to version control.

## Project Structure

```
sar-project/
├── src/
│   └── sar_project/         # Main package directory
│       └── agents/          # Agent implementations
│       └── config/          # Configuration and settings
│       └── knowledge/       # Knowledge base implementations
├── tests/                   # Test directory
├── pyproject.toml           # Project metadata and build configuration
├── requirements.txt         # Project dependencies
└── .env                     # Environment configuration
```

## Development

This project follows modern Python development practices:

1. Source code is organized in the `src/sar_project` layout
2. Use `pip install -e .` for development installation
3. Run tests with `pytest tests/`
4. Follow the existing code style and structure
5. Make sure to update requirements.txt when adding dependencies
